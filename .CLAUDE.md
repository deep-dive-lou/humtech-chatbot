# HumTech Platform — Claude Rules (v1)

You are assisting in the humtech-platform monorepo. It contains two active modules:

- `app/bot/` — multi-tenant AI booking chatbot (existing)
- `app/engine/` — revenue event engine (existing)
- `app/outreach/` — cold outreach pipeline (new)

All modules share the FastAPI app (`app/main.py`), DB pool (`app/db.py`), and config (`app/config.py`).

---

## Source of truth

- Architecture and behaviour are defined in `.docs/`
- DB schema is defined ONLY in migration files: `scripts/migrations/`
- Never invent table/column names. If it's not in the migration, it doesn't exist.
- Chatbot docs: `.docs/chatbot/`
- Outreach docs: `.docs/outreach/`
- Revenue engine docs: `.docs/rev_engine/`

---

## Non-negotiables

- All durable state is in Postgres (DO managed database).
- Secrets/tokens never in DB — env vars only (`.env` for local, environment for prod).
- asyncpg JSONB codec is enabled — pass Python dicts, NOT json.dumps strings.
- Worker logic must be idempotent.

---

## Change policy

- Minimal, explicit changes only.
- Do not refactor unrelated modules.
- If a change touches DB schema, write a new migration file (004_, 005_, etc.).
- If behaviour changes, update exactly ONE doc section.

---

## Outreach module rules

- Personalisation truth rules are non-negotiable — see `.docs/outreach/02_personalisation_spec.md`
- Never fabricate signal claims. If `evidence_used` is empty, the rung must be ≤ 2.
- Quality gate routing (AUTO_SEND / NEEDS_REVIEW / BLOCK) is defined in `pipeline.py:_determine_review_status()`
- Prompt version is tracked in `outreach.personalisation.prompt_version` — increment when changing the prompt.

---

## Quick index

### Bot
- System: `.docs/chatbot/directories/00_system_overview.md`
- Schema: `.docs/chatbot/directories/01_db_schema_reference.md`
- State machine: `.docs/chatbot/directories/02_state_machine.md`
- Skills: `.docs/chatbot/skills/*.md`

### Outreach
- System: `.docs/outreach/00_system_overview.md`
- Pipeline: `.docs/outreach/01_pipeline.md`
- Personalisation: `.docs/outreach/02_personalisation_spec.md`
- Review UI: `.docs/outreach/03_review_ui.md`
- Sending: `.docs/outreach/04_sending.md`
- Reply handling: `.docs/outreach/05_reply_handling.md`
- Dev runbook: `.docs/outreach/06_dev_runbook.md`

---

## Running the app locally

```
powershell -Command "Start-Process -FilePath 'C:\Users\loumk\humtech-platform\.venv\Scripts\python.exe' -ArgumentList '-m','uvicorn','app.main:app','--port','8000' -WorkingDirectory 'C:\Users\loumk\humtech-platform' -WindowStyle Hidden"
```

Review UI: http://localhost:8000/outreach/review
